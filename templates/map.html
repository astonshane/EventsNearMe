{% extends "layout.html" %}

{% block title %}EventsNear.me{% endblock %}	


{% block links %}
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='map.css') }}">
<link rel="import" href="/static/bower_components/google-map/google-map.html">
<link rel="import" href="/static/bower_components/polymer/polymer.html">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

{% endblock %}

{% block body %}

<style>
	.popup[on = "true"]
	{
		display: block;
		position: absolute;
		top: 25%;
		left: 25%;
		height: 25%;
		width: 25%;
		background-color: #FFFFFF;
		z-index: 9;
	}
	.popup
	{
		display:none;
	}
	
	.txtArea
	{
		display: block;
		top: 50%;
		left: 50%;
		height: 50%;
		width: 50%;
		z-index: 150;
		background-color #FFF000;
	}
	
	.txtlbl
	{
		text-align: center;
		left:25%;
	}
	
	.enter
	{
		display: block;
		top: 70%;
		left: 5%;
		height: 10%;
		width: 10%;
		z-index: 150;
		background-color #FFF000;
	}
	
</style>

<paper-input label="No Location found" on="false" id="dialog" class="popup">
	<h4 class="txtlbl">We could not locate you</h4>  
	<input is="core-input" placeholder="Zip Code" class ="txtArea" char-counter maxlength="10">
	 <paper-button tabindex="0" raised class="enter">Enter</paper-button>
</paper-input>

<google-map latitude="42.7251071" longitude="-73.6834544" zoom="15">
	{% for event in events %}
	<google-map-marker latitude={{event.lat}} longitude={{event.lon}} title={{event.name}}>
		{{event.name}}
	</google-map-marker>
	{% endfor %}
</google-map>

<script>
	$("document").ready(function() {
		navigator.geolocation.getCurrentPosition(showMap, showError);
	});
	
		
	function showMap(position) {
		var map = document.querySelector('google-map');
		map.latitude = position.coords.latitude;
		map.longitude = position.coords.longitude;
		  
		$("google-map").append('<google-map-marker latitude=' + position.coords.latitude + ' longitude=' + position.coords.longitude +' title="You"></google-map-marker>'); 
		}
	
	function showMap2(lat,lng) {
		var map = document.querySelector('google-map');
		map.latitude = lat
		map.longitude = lng;
		  
		$("google-map").append('<google-map-marker latitude=' + lat + ' longitude=' + lng +' title="You"></google-map-marker>'); 
		}
		
	function showError(error) {
		lat = 2.737003099999995;
		lng = -73.6697768;
				
		var dlg = document.getElementById("dialog");
		dlg.setAttribute('on',"true");
		
		var x = $( ".enter" );
		console.log(x);
		
		$( ".enter" ).click(function() {
			var t = $(".txtArea");
			var zip = t[0].value;
			dlg.setAttribute('on',"false");
			//alert(zip);
			//zip to lat,lng here
			showMap2(lat,lng);
		});		
	}
	
</script>

{% endblock %}
